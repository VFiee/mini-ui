{"version":3,"file":"index.js","sources":["../../../packages/components/field/baseInput.tsx","../../../packages/components/field/index.tsx"],"sourcesContent":["import React from \"react\";\nimport { Input, Textarea } from \"@tarojs/components\";\nimport { InputProps } from \"types\";\n\nconst BaseInput = (props: InputProps) => {\n  const { isTextarea, ...rest } = props;\n  const Component = isTextarea ? Textarea : Input;\n  return <Component {...rest} />;\n};\n\nexport default BaseInput;\n","import React, { useRef } from \"react\";\nimport { View } from \"@tarojs/components\";\nimport Icon from \"components/icon\";\nimport Cell from \"components/cell\";\nimport { compact, isFunction, isUndefined, mergeStyle, pick } from \"utils\";\nimport { useUpdate } from \"hooks\";\nimport Input from \"./baseInput\";\nimport { IconProps, CellProps, InputProps, FieldProps } from \"types\";\n\nconst defaultFieldProps = {\n  type: \"text\",\n  fixed: false,\n  autoHeight: true,\n  maxlength: 200,\n  showConfirmBar: false,\n  disableDefaultPadding: true,\n  clear: false,\n  clearTrigger: \"focus\",\n  showWordLimit: false,\n  inputAlign: \"left\",\n  showError: true,\n  formatTriggleType: \"onChange\",\n  placeholderClass: \"input-placeholder\",\n};\n\nconst getIconProps = (\n  props: string | IconProps | undefined,\n  fn: any\n): string | IconProps | undefined => {\n  if (!isFunction(fn) || isUndefined(undefined)) return props;\n  if (typeof props === \"string\") {\n    return {\n      type: props,\n      onClick: fn,\n    };\n  }\n  return props?.onClick ? props : { ...(props as IconProps), onClick: fn };\n};\n\nconst getCellProps = (props: FieldProps): CellProps => {\n  const {\n    colon,\n    leftIcon,\n    rightIcon,\n    required,\n    center,\n    label,\n    labelClass,\n    labelStyle,\n    labelAlign,\n    inputAlign,\n    onLeftIconClick,\n    onRightIconClick,\n  } = props;\n  return compact(\n    {\n      colon,\n      required,\n      center,\n      title: label,\n      titleStyle: labelStyle,\n      titleClass: `__field__label__ ${\n        labelAlign ? `__field__label__${labelAlign}__` : \"\"\n      } ${labelClass ?? \"\"} `,\n      valueClass: `__field__value__ ${\n        inputAlign ? `__field__value__${inputAlign}__` : \"\"\n      }`,\n      icon: getIconProps(leftIcon, onLeftIconClick),\n      rightIcon: getIconProps(rightIcon, onRightIconClick),\n    },\n    isUndefined\n  ) as CellProps;\n};\n\nconst getInputProps = (props: FieldProps): InputProps => {\n  const {\n    type,\n    maxlength,\n    inputClass,\n    fixed,\n    readonly,\n    disabled,\n    autoHeight,\n    showConfirmBar,\n    disableDefaultPadding,\n    onLineChange,\n  } = props;\n  let inputProps = pick(props, [\n    // input\n    \"value\",\n    \"placeholder\",\n    \"placeholderClass\",\n    \"placeholderStyle\",\n    \"cursorSpacing\",\n    \"focus\",\n    \"confirmType\",\n    \"confirmHold\",\n    \"alwaysEmbed\",\n    \"cursor\",\n    \"selectionStart\",\n    \"selectionEnd\",\n    \"adjustPosition\",\n    \"holdKeyboard\",\n    \"inputStyle\",\n    \"onInput\",\n    \"onFocus\",\n    \"onBlur\",\n    \"onConfirm\",\n    \"onKeyboardHeightChange\",\n  ]);\n  inputProps = {\n    ...inputProps,\n    disabled: disabled || readonly,\n    isTextarea: type === \"textarea\",\n    password: type === \"password\",\n    type: type === \"tel\" ? \"number\" : type,\n    maxlength: type === \"tel\" ? 11 : maxlength,\n    className: `__field__control__ ${\n      type === \"textarea\" ? \"__field__textarea__\" : \"\"\n    } ${inputClass ?? \"\"}`,\n  };\n  if (inputProps.isTextarea) {\n    delete inputProps[\"type\"];\n    inputProps = {\n      ...inputProps,\n      fixed,\n      autoHeight,\n      showConfirmBar,\n      disableDefaultPadding,\n      onLineChange,\n    };\n  }\n  return compact(inputProps, isUndefined) as InputProps;\n};\n\nconst getErrorProps = (props: FieldProps): object => {\n  let { errorClass, errorStyle, errorAlign, errorMsg } = props;\n  return compact(\n    {\n      style: mergeStyle(errorStyle, errorMsg ? \"\" : `display:none;`),\n      className: `__field__error__ ${errorClass ?? \"\"} ${\n        errorAlign ? `__field__error__${errorAlign}__` : \"\"\n      }`,\n    },\n    isUndefined\n  );\n};\n\nconst getWordLimitProps = (props: FieldProps): object => {\n  const { limitClass, limitStyle } = props;\n  return compact(\n    {\n      style: limitStyle,\n      className: `__field__limit__ ${limitClass ?? \"\"}`,\n    },\n    isUndefined\n  );\n};\n\nconst formatFn = (_value: any, fn?: Function): any => {\n  return isFunction(fn) ? fn?.(_value) : _value;\n};\n\nconst Field = (props: FieldProps) => {\n  let { formatter, formatTrigger, disabled, readonly } = props;\n  const update = useUpdate();\n  let valueRef = useRef(props?.value ?? \"\");\n  let focusRef = useRef(!!props?.focus);\n  const onFocus = (eve) => {\n    focusRef.current = true;\n    props?.onFocus?.(eve);\n    update();\n  };\n  const onBlur = (eve) => {\n    focusRef.current = false;\n    // 格式化\n    if (formatTrigger === \"onBlur\") {\n      valueRef.current = formatFn(valueRef.current, formatter);\n    }\n    props?.onBlur?.(eve);\n    update();\n  };\n  const onInput = (eve) => {\n    valueRef.current = eve.detail.value;\n    // 格式化\n    if (formatTrigger === \"onChange\") {\n      valueRef.current = formatFn(valueRef.current, formatter);\n    }\n    if (isFunction(props.onInput)) {\n      let callbackValue = (props.onInput as Function)(eve);\n      if (!isUndefined(callbackValue)) {\n        valueRef.current = callbackValue;\n      }\n    }\n    // 校验\n    update();\n    return valueRef.current;\n  };\n  const _props = {\n    ...defaultFieldProps,\n    ...props,\n    onFocus,\n    onBlur,\n    onInput,\n    value: valueRef.current,\n  } as FieldProps;\n  const {\n    showError,\n    errorMsg,\n    type,\n    maxlength,\n    clear,\n    clearTrigger,\n    onClear: _onClear,\n  } = _props;\n  const cellProps = getCellProps(_props);\n  const errorProps = getErrorProps(_props);\n  const wordLimitProps = getWordLimitProps(_props);\n  const onClear = (eve) => {\n    valueRef.current = \"\";\n    focusRef.current = false;\n    _onClear?.(eve);\n    update();\n  };\n  const showClear =\n    !(disabled || readonly) &&\n    valueRef.current.length > 0 &&\n    (clearTrigger === \"focus\" ? focusRef.current : true);\n\n  const fieldValue = (\n    <React.Fragment>\n      <View className=\"__field__value__body__\">\n        <Input {...getInputProps(_props)} />\n        {clear && (\n          <Icon\n            type=\"close-filled\"\n            className=\"__field__clear__\"\n            style={showClear ? \"\" : `display:none`}\n            onClick={onClear}\n          />\n        )}\n      </View>\n      {type === \"textarea\" && (maxlength as number) > 0 && (\n        <View {...wordLimitProps}>{`${\n          valueRef.current?.length ?? 0\n        }/${maxlength}`}</View>\n      )}\n      {!!showError && <View {...errorProps}>{errorMsg}</View>}\n    </React.Fragment>\n  );\n  return (\n    <Cell\n      {...cellProps}\n      className={`__field__ ${_props?.disabled ? `__field__disabled__` : \"\"} ${\n        _props?.readonly ? `__field__readonly__` : \"\"\n      } ${_props?.className ?? \"\"}`}\n      value={fieldValue}\n    >\n      {props?.children}\n    </Cell>\n  );\n};\n\nexport default Field;\n"],"names":["Input"],"mappings":"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"}