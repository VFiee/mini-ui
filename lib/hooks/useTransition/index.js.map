{"version":3,"file":"index.js","sources":["../../../packages/hooks/useTransition/index.ts"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport { requestAnimationFrame } from \"utils\";\n\n// TODO: remove TransitionType to types/transition\nexport declare type TransitionType =\n  | \"fade\"\n  | \"fadeUp\"\n  | \"fadeDown\"\n  | \"fadeLeft\"\n  | \"fadeRight\"\n  | \"slideUp\"\n  | \"slideDown\"\n  | \"slideLeft\"\n  | \"slideRight\";\n\ndeclare type TransitionStatus = \"enter\" | \"enterTo\" | \"leave\" | \"leaveTo\";\n\nconst getClassNames = (name: TransitionType) => ({\n  enter: `__${name}__enter__ __${name}__enter__active__ ${name}-enter-active`,\n  enterTo: `__${name}__enter__to__ __${name}__enter__active__ ${name}-enter-active`,\n  leave: `__${name}__leave__ __${name}__leave__active__ ${name}-leave-active`,\n  leaveTo: `__${name}__leave__to__ __${name}__leave__active__ ${name}-leave-active`,\n});\n\nexport declare interface useTransitionProps {\n  show: boolean;\n  name: TransitionType;\n  transitionDuration: number; //ms\n  beforeEnter?: Function;\n  onEnter?: Function;\n  beforeLeave?: Function;\n  onLeave?: Function;\n}\n\nconst useTransition = (props: useTransitionProps) => {\n  const {\n    show,\n    name,\n    beforeEnter,\n    onEnter,\n    beforeLeave,\n    onLeave,\n    transitionDuration,\n  } = props;\n  const [inited, setInited] = useState(false);\n  const [display, setDisplay] = useState(show);\n  const [className, setClassName] = useState(\"\");\n\n  useEffect(() => {\n    if (show === display) {\n      return;\n    }\n    show ? enter() : leave();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [show]);\n  let status: null | TransitionStatus = null;\n  let transitionEnded: boolean;\n  function enter() {\n    status = \"enter\";\n    const classes = getClassNames(name);\n    beforeEnter && beforeEnter();\n    requestAnimationFrame(() => {\n      onEnter && onEnter();\n      !inited && setInited(true);\n      setDisplay(true);\n      setClassName(classes.enter);\n      requestAnimationFrame(() => {\n        status = \"enterTo\";\n        transitionEnded = false;\n        setClassName(classes.enterTo);\n      });\n    });\n  }\n  function leave() {\n    status = \"leave\";\n    const classes = getClassNames(name);\n    beforeLeave && beforeLeave();\n    requestAnimationFrame(() => {\n      onLeave && onLeave();\n      setClassName(classes.leave);\n      requestAnimationFrame(() => {\n        status = \"leaveTo\";\n        transitionEnded = false;\n        setTimeout(() => onTransitionEnd(), transitionDuration);\n        setClassName(classes.leaveTo);\n      });\n    });\n  }\n  function onTransitionEnd() {\n    if (transitionEnded) return;\n    status = null;\n    transitionEnded = true;\n    // setClassName(\"\");\n    if (!show && display) {\n      setDisplay(false);\n    }\n  }\n  return {\n    inited,\n    status,\n    display,\n    className,\n    transitionDuration,\n    onTransitionEnd,\n  };\n};\n\nexport default useTransition;\n"],"names":[],"mappings":"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"}